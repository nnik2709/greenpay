import{u as f,r as s,s as y,j as t,I as n,B as j}from"./index-f386841f.js";import{X as v}from"./index.es-d321edd5.js";import{V as C}from"./VoucherPrint-580d5f3f.js";import{E as V}from"./ExportButton-bbdea4ab.js";import{Q as _}from"./qr-code-f7e195e1.js";import"./xlsx-f5126985.js";import"./file-spreadsheet-279cbcb4.js";const S={header:{style:{minHeight:"56px"}},headRow:{style:{borderTopStyle:"solid",borderTopWidth:"1px",borderTopColor:"#E2E8F0",backgroundColor:"#F8FAFC"}},headCells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"},color:"#475569",fontSize:"12px",fontWeight:"600",textTransform:"uppercase"}},cells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"}}}},a=({title:l,value:r})=>t.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200",children:[t.jsx("p",{className:"text-sm text-slate-500",children:l}),t.jsx("p",{className:"text-2xl font-bold text-slate-800",children:r})]}),D=()=>{const{toast:l}=f(),[r,c]=s.useState([]),[u,h]=s.useState(!0),[p,m]=s.useState(null),[x,d]=s.useState(!1);s.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:e,error:o}=await y.from("corporate_vouchers").select("*").order("created_at",{ascending:!1});if(o)throw o;c(e||[])}catch(e){console.error("Error fetching vouchers:",e),l({title:"Error",description:"Failed to load vouchers",variant:"destructive"})}finally{h(!1)}},b=e=>{m(e),d(!0)},i=[{name:"Voucher Code",selector:e=>e.voucher_code,sortable:!0,width:"150px"},{name:"Company",selector:e=>e.company_name,sortable:!0},{name:"Passport No",selector:e=>e.passport_number,sortable:!0},{name:"Quantity",selector:e=>e.quantity,sortable:!0,right:!0},{name:"Amount",selector:e=>`PGK ${e.amount}`,sortable:!0,right:!0},{name:"Payment Method",selector:e=>e.payment_method,sortable:!0},{name:"Created",selector:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"Valid Until",selector:e=>new Date(e.valid_until).toLocaleDateString(),sortable:!0},{name:"Status",selector:e=>e.used_at?"Used":"Valid",sortable:!0,cell:e=>t.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${e.used_at?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"}`,children:e.used_at?"Used":"Valid"})},{name:"Actions",cell:e=>t.jsx(j,{size:"sm",variant:"outline",onClick:()=>b(e),disabled:e.used_at!==null,title:e.used_at?"Cannot print used voucher":"Print voucher",children:t.jsx(_,{className:"w-4 h-4"})}),width:"100px"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Corporate Voucher Reports"}),t.jsx(V,{data:r,columns:i,filename:"Corporate_Voucher_Report",title:"Corporate Voucher Report"})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx(a,{title:"Total Records",value:r.length}),t.jsx(a,{title:"Total Quantity",value:r.reduce((e,o)=>e+(o.quantity||0),0)}),t.jsx(a,{title:"Total Amount",value:`PGK ${r.reduce((e,o)=>e+parseFloat(o.amount||0),0).toFixed(2)}`}),t.jsx(a,{title:"Valid Vouchers",value:r.filter(e=>!e.used_at).length})]}),t.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[t.jsx(n,{placeholder:"Filter by Company..."}),t.jsx(n,{placeholder:"Filter by Payment Mode..."}),t.jsx(n,{type:"date",placeholder:"Date From"})]}),t.jsx(v,{columns:i,data:r,pagination:!0,customStyles:S,highlightOnHover:!0,pointerOnHover:!0,progressPending:u})]}),t.jsx(C,{voucher:p,isOpen:x,onClose:()=>d(!1),voucherType:"Corporate"})]})};export{D as default};

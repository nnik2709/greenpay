import{r as s,s as R,j as t,I as g}from"./index-f386841f.js";import{X as O}from"./index.es-d321edd5.js";import{E as K}from"./ExportButton-bbdea4ab.js";import"./xlsx-f5126985.js";import"./file-spreadsheet-279cbcb4.js";const E=[{name:"Type",selector:a=>a.type,sortable:!0},{name:"Total Exit Pass",selector:a=>a.totalExitPass,sortable:!0,right:!0},{name:"Exit Pass Value",selector:a=>a.exitPassValue,sortable:!0,right:!0},{name:"Total Amount",selector:a=>a.totalAmount,sortable:!0,right:!0},{name:"Discount",selector:a=>a.discount,sortable:!0,right:!0},{name:"Amount After Discount",selector:a=>a.amountAfterDiscount,sortable:!0,right:!0},{name:"Collected Amount",selector:a=>a.collectedAmount,sortable:!0,right:!0},{name:"Returned Amount",selector:a=>a.returnedAmount,sortable:!0,right:!0},{name:"Payment Mode",selector:a=>a.paymentMode,sortable:!0},{name:"Payment Date",selector:a=>a.paymentDate,sortable:!0}],V={header:{style:{minHeight:"56px"}},headRow:{style:{borderTopStyle:"solid",borderTopWidth:"1px",borderTopColor:"#E2E8F0",backgroundColor:"#F8FAFC"}},headCells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"},color:"#475569",fontSize:"12px",fontWeight:"600",textTransform:"uppercase"}},cells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"}}}},u=({title:a,value:p})=>t.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200",children:[t.jsx("p",{className:"text-sm text-slate-500",children:a}),t.jsx("p",{className:"text-2xl font-bold text-slate-800",children:p})]}),X=()=>{const[a,p]=s.useState([]),[D,h]=s.useState(!0),[x,N]=s.useState(""),[d,C]=s.useState(""),[i,T]=s.useState(""),[c,P]=s.useState({totalRecords:0,totalExitPass:0,totalAmount:0,totalCollected:0,totalDiscount:0,totalReturned:0}),[f,y]=s.useState(null);s.useEffect(()=>{b()},[d,i]);const b=async()=>{try{h(!0),y(null);let r=R.from("individual_purchases").select("*").order("created_at",{ascending:!1});d&&(r=r.gte("created_at",d)),i&&(r=r.lte("created_at",i));const{data:w,error:j}=await r;if(j)throw j;let m=R.from("corporate_vouchers").select("*").order("created_at",{ascending:!1});d&&(m=m.gte("created_at",d)),i&&(m=m.lte("created_at",i));const{data:S,error:A}=await m;if(A)throw A;const _=(w||[]).map(e=>({id:`ind-${e.id}`,type:"Individual",totalExitPass:1,exitPassValue:e.amount||0,totalAmount:e.amount||0,discount:0,amountAfterDiscount:e.amount||0,collectedAmount:e.amount||0,returnedAmount:0,paymentMode:e.payment_method||"N/A",paymentDate:e.created_at?new Date(e.created_at).toISOString().split("T")[0]:"N/A"})),l={};(S||[]).forEach(e=>{const o=`${e.company_name}-${e.created_at.split("T")[0]}`;l[o]||(l[o]={id:`corp-${o}`,type:"Corporate",totalExitPass:0,exitPassValue:e.amount||0,totalAmount:0,discount:0,amountAfterDiscount:0,collectedAmount:0,returnedAmount:0,paymentMode:e.payment_method||"N/A",paymentDate:e.created_at?new Date(e.created_at).toISOString().split("T")[0]:"N/A",companyName:e.company_name}),l[o].totalExitPass+=e.quantity||1,l[o].totalAmount+=e.amount||0,l[o].amountAfterDiscount+=e.amount||0,l[o].collectedAmount+=e.amount||0});const F=Object.values(l),n=[..._,...F];p(n);const G=n.length,L=n.reduce((e,o)=>e+o.totalExitPass,0),$=n.reduce((e,o)=>e+o.totalAmount,0),M=n.reduce((e,o)=>e+o.collectedAmount,0),k=n.reduce((e,o)=>e+o.discount,0),I=n.reduce((e,o)=>e+o.returnedAmount,0);P({totalRecords:G,totalExitPass:L,totalAmount:$,totalCollected:M,totalDiscount:k,totalReturned:I})}catch(r){console.error("Error fetching revenue data:",r),y(r.message||"Failed to load revenue data")}finally{h(!1)}},v=a.filter(r=>!x||r.type.toLowerCase().includes(x.toLowerCase()));return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Revenue Generated Reports"}),t.jsx(K,{data:v,columns:E,filename:"Revenue_Report",title:"Revenue Generated Report"})]}),f&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error loading revenue data"}),t.jsx("div",{className:"mt-2 text-sm text-red-700",children:t.jsx("p",{children:f})}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:b,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Try Again"})})]})]})}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[t.jsx(u,{title:"Total Records",value:c.totalRecords}),t.jsx(u,{title:"Total Exit Pass",value:c.totalExitPass}),t.jsx(u,{title:"Total Amount",value:`PGK ${c.totalAmount.toFixed(2)}`}),t.jsx(u,{title:"Total Collected",value:`PGK ${c.totalCollected.toFixed(2)}`}),t.jsx(u,{title:"Total Discount",value:`PGK ${c.totalDiscount.toFixed(2)}`}),t.jsx(u,{title:"Total Returned",value:`PGK ${c.totalReturned.toFixed(2)}`})]}),t.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[t.jsx(g,{placeholder:"Filter by Type...",value:x,onChange:r=>N(r.target.value)}),t.jsx(g,{type:"date",placeholder:"Date From",value:d,onChange:r=>C(r.target.value)}),t.jsx(g,{type:"date",placeholder:"Date To",value:i,onChange:r=>T(r.target.value)})]}),t.jsx(O,{columns:E,data:v,pagination:!0,customStyles:V,highlightOnHover:!0,pointerOnHover:!0,progressPending:D,progressComponent:t.jsx("div",{className:"py-8",children:"Loading revenue data..."}),noDataComponent:t.jsx("div",{className:"py-8 text-slate-500",children:"No revenue data found"})})]})]})};export{X as default};

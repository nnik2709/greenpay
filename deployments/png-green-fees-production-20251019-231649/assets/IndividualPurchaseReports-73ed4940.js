import{u as f,r as s,s as v,j as t,I as a,B as y}from"./index-f386841f.js";import{X as j}from"./index.es-d321edd5.js";import{V as P}from"./VoucherPrint-580d5f3f.js";import{E as _}from"./ExportButton-bbdea4ab.js";import{Q as S}from"./qr-code-f7e195e1.js";import"./xlsx-f5126985.js";import"./file-spreadsheet-279cbcb4.js";const N={header:{style:{minHeight:"56px"}},headRow:{style:{borderTopStyle:"solid",borderTopWidth:"1px",borderTopColor:"#E2E8F0",backgroundColor:"#F8FAFC"}},headCells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"},color:"#475569",fontSize:"12px",fontWeight:"600",textTransform:"uppercase"}},cells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"}}}},l=({title:d,value:r})=>t.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200",children:[t.jsx("p",{className:"text-sm text-slate-500",children:d}),t.jsx("p",{className:"text-2xl font-bold text-slate-800",children:r})]}),I=()=>{const{toast:d}=f(),[r,c]=s.useState([]),[u,h]=s.useState(!0),[p,m]=s.useState(null),[x,i]=s.useState(!1);s.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:e,error:o}=await v.from("individual_purchases").select("*").order("created_at",{ascending:!1});if(o)throw o;c(e||[])}catch(e){console.error("Error fetching vouchers:",e),d({title:"Error",description:"Failed to load vouchers",variant:"destructive"})}finally{h(!1)}},b=e=>{m(e),i(!0)},n=[{name:"Voucher Code",selector:e=>e.voucher_code,sortable:!0,width:"150px"},{name:"Passport No",selector:e=>e.passport_number,sortable:!0},{name:"Amount",selector:e=>`PGK ${e.amount}`,sortable:!0,right:!0},{name:"Payment Method",selector:e=>e.payment_method,sortable:!0},{name:"Created",selector:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"Valid Until",selector:e=>new Date(e.valid_until).toLocaleDateString(),sortable:!0},{name:"Status",selector:e=>e.used_at?"Used":"Valid",sortable:!0,cell:e=>t.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${e.used_at?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"}`,children:e.used_at?"Used":"Valid"})},{name:"Actions",cell:e=>t.jsx(y,{size:"sm",variant:"outline",onClick:()=>b(e),disabled:e.used_at!==null,title:e.used_at?"Cannot print used voucher":"Print voucher",children:t.jsx(S,{className:"w-4 h-4"})}),width:"100px"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Individual Purchase Reports"}),t.jsx(_,{data:r,columns:n,filename:"Individual_Purchase_Report",title:"Individual Purchase Report"})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsx(l,{title:"Total Records",value:r.length}),t.jsx(l,{title:"Total Amount",value:`PGK ${r.reduce((e,o)=>e+parseFloat(o.amount||0),0).toFixed(2)}`}),t.jsx(l,{title:"Valid Vouchers",value:r.filter(e=>!e.used_at).length}),t.jsx(l,{title:"Used Vouchers",value:r.filter(e=>e.used_at).length})]}),t.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[t.jsx(a,{placeholder:"Filter by Passport No..."}),t.jsx(a,{placeholder:"Filter by Nationality..."}),t.jsx(a,{placeholder:"Filter by Payment Method..."}),t.jsx(a,{type:"date",placeholder:"Date From"})]}),t.jsx(j,{columns:n,data:r,pagination:!0,customStyles:N,highlightOnHover:!0,pointerOnHover:!0,progressPending:u})]}),t.jsx(P,{voucher:p,isOpen:x,onClose:()=>i(!1),voucherType:"Individual"})]})};export{I as default};

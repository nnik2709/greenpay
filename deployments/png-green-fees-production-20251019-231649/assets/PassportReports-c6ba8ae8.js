import{ah as R,r,j as s,I as c}from"./index-f386841f.js";import{X as O}from"./index.es-d321edd5.js";const b=R("https://gzaezpexrtwwpntclonu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd6YWV6cGV4cnR3d3BudGNsb251Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODM0NjMsImV4cCI6MjA3NDQ1OTQ2M30.87cHSZJR2XQZERuzCcNCnm56WNKOmjfaklF07NY0-tw"),D=[{name:"Type",selector:e=>e.type,sortable:!0},{name:"Nationality",selector:e=>e.nationality,sortable:!0},{name:"Passport No",selector:e=>e.passportNo,sortable:!0},{name:"Surname",selector:e=>e.surname,sortable:!0},{name:"Given Name",selector:e=>e.givenName,sortable:!0},{name:"DOB",selector:e=>e.dob,sortable:!0},{name:"Sex",selector:e=>e.sex,sortable:!0},{name:"Date of Expiry",selector:e=>e.dateOfExpiry,sortable:!0}],T={header:{style:{minHeight:"56px"}},headRow:{style:{borderTopStyle:"solid",borderTopWidth:"1px",borderTopColor:"#E2E8F0",backgroundColor:"#F8FAFC"}},headCells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"},color:"#475569",fontSize:"12px",fontWeight:"600",textTransform:"uppercase"}},cells:{style:{"&:not(:last-of-type)":{borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:"#E2E8F0"}}}},k=()=>{const[e,g]=r.useState(""),[o,f]=r.useState(""),[y,N]=r.useState([]),[v,u]=r.useState(!0),[d,C]=r.useState(""),[p,j]=r.useState("");r.useEffect(()=>{S()},[e,o]);const S=async()=>{try{u(!0);let t=b.from("passports").select("*").order("created_at",{ascending:!1});e&&(t=t.gte("created_at",e)),o&&(t=t.lte("created_at",o));const{data:l,error:n}=await t;if(n)throw n;const m=(l||[]).map(a=>({id:a.id,type:"P",nationality:a.nationality,passportNo:a.passport_number,surname:a.surname,givenName:a.given_name,dob:a.date_of_birth,sex:a.sex,dateOfExpiry:a.date_of_expiry}));N(m)}catch(t){console.error("Error fetching passports:",t),alert("Failed to load passports")}finally{u(!1)}},w=async()=>{var h;const{data:t}=await b.auth.getSession(),l=(h=t==null?void 0:t.session)==null?void 0:h.access_token;if(!l){alert("You must be logged in to export");return}const n="https://gzaezpexrtwwpntclonu.supabase.co/functions/v1/report-export",m={type:"passports",filters:{...e?{from:e}:{},...o?{to:o}:{}},format:"csv"},a=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!a.ok){const I=await a.text();alert(`Export failed: ${I}`);return}const F=await a.blob(),x=URL.createObjectURL(F),i=document.createElement("a");i.href=x,i.download=`report_passports_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(x)},E=y.filter(t=>{const l=!d||t.passportNo.toLowerCase().includes(d.toLowerCase()),n=!p||t.surname.toLowerCase().includes(p.toLowerCase());return l&&n});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[s.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Passports Report"}),s.jsx("button",{onClick:w,className:"inline-flex items-center rounded-md bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-700",children:"Export CSV"})]}),s.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"text-sm text-slate-600 mb-1",children:"From"}),s.jsx(c,{type:"date",value:e,onChange:t=>g(t.target.value)})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"text-sm text-slate-600 mb-1",children:"To"}),s.jsx(c,{type:"date",value:o,onChange:t=>f(t.target.value)})]}),s.jsx(c,{placeholder:"Filter by Passport No...",value:d,onChange:t=>C(t.target.value)}),s.jsx(c,{placeholder:"Filter by Surname...",value:p,onChange:t=>j(t.target.value)})]}),s.jsx(O,{columns:D,data:E,pagination:!0,customStyles:T,highlightOnHover:!0,pointerOnHover:!0,progressPending:v,progressComponent:s.jsx("div",{className:"py-8",children:"Loading passports..."}),noDataComponent:s.jsx("div",{className:"py-8 text-slate-500",children:"No passports found"})})]})]})};export{k as default};

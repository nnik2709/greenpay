import{p as g,u as U,r as n,s as j,j as e,B as C,C as o,a as c,b as d,S as G,d as m,L as a,I as h}from"./index-f386841f.js";import{S as O}from"./switch-357df985.js";import{T as x}from"./textarea-2b2caf3d.js";import{S as R}from"./save-bfaf2e9f.js";import{K as F}from"./key-95ea7c62.js";import{G as K}from"./globe-21edfe06.js";import{S as I}from"./send-f7a2142e.js";const V=g("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),M=g("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),T=g("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),B=()=>{const{toast:i}=U(),[t,v]=n.useState({enabled:!1,provider:"twilio",apiKey:"",apiSecret:"",fromNumber:"",webhookUrl:"",testPhoneNumber:"",templates:{voucherGenerated:"Your PNG Green Fee voucher {{VOUCHER_CODE}} is ready. Amount: PGK {{AMOUNT}}. Valid until {{EXPIRY_DATE}}.",paymentConfirmation:"Payment confirmed for PGK {{AMOUNT}}. Voucher {{VOUCHER_CODE}} generated successfully.",passwordReset:"Your password reset code is {{RESET_CODE}}. Valid for 10 minutes.",systemAlert:"System Alert: {{MESSAGE}}"}}),[E,b]=n.useState(!0),[S,f]=n.useState(!1),[N,y]=n.useState(!1),[w,P]=n.useState("");n.useEffect(()=>{A()},[]);const A=async()=>{try{b(!0);const{data:s,error:l}=await j.from("sms_settings").select("*").single();if(l&&l.code!=="PGRST116")throw l;s&&v({enabled:s.enabled||!1,provider:s.provider||"twilio",apiKey:s.api_key||"",apiSecret:s.api_secret||"",fromNumber:s.from_number||"",webhookUrl:s.webhook_url||"",testPhoneNumber:s.test_phone_number||"",templates:s.templates||t.templates})}catch(s){console.error("Error loading SMS settings:",s),i({title:"Error",description:"Failed to load SMS settings",variant:"destructive"})}finally{b(!1)}},k=async()=>{try{f(!0);const{error:s}=await j.from("sms_settings").upsert({id:1,enabled:t.enabled,provider:t.provider,api_key:t.apiKey,api_secret:t.apiSecret,from_number:t.fromNumber,webhook_url:t.webhookUrl,test_phone_number:t.testPhoneNumber,templates:t.templates,updated_at:new Date().toISOString()});if(s)throw s;i({title:"Settings Saved",description:"SMS settings have been updated successfully"})}catch(s){console.error("Error saving SMS settings:",s),i({title:"Error",description:"Failed to save SMS settings",variant:"destructive"})}finally{f(!1)}},_=async()=>{if(!t.testPhoneNumber){i({title:"Test Phone Required",description:"Please enter a test phone number",variant:"destructive"});return}try{y(!0);const{error:s}=await j.functions.invoke("send-sms",{body:{to:t.testPhoneNumber,message:w||"Test SMS from PNG Green Fees System",provider:t.provider,apiKey:t.apiKey,apiSecret:t.apiSecret,fromNumber:t.fromNumber}});if(s)throw s;i({title:"Test SMS Sent",description:`Test message sent to ${t.testPhoneNumber}`})}catch(s){console.error("Error sending test SMS:",s),i({title:"Test Failed",description:s.message||"Failed to send test SMS",variant:"destructive"})}finally{y(!1)}},r=(s,l)=>{v(u=>({...u,[s]:l}))},p=(s,l)=>{v(u=>({...u,templates:{...u.templates,[s]:l}}))};return E?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"SMS Settings"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Configure SMS notifications and messaging"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:_,variant:"outline",disabled:N||!t.enabled,className:"text-emerald-600 border-emerald-300 hover:bg-emerald-50",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),N?"Testing...":"Test SMS"]}),e.jsxs(C,{onClick:k,disabled:S,className:"bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),S?"Saving...":"Save Settings"]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"General Settings"]})}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-base font-semibold",children:"Enable SMS Notifications"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Allow the system to send SMS messages"})]}),e.jsx(O,{checked:t.enabled,onCheckedChange:s=>r("enabled",s)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"provider",children:"SMS Provider"}),e.jsxs("select",{id:"provider",value:t.provider,onChange:s=>r("provider",s.target.value),className:"w-full mt-1 px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"twilio",children:"Twilio"}),e.jsx("option",{value:"aws-sns",children:"AWS SNS"}),e.jsx("option",{value:"local",children:"Local Provider"})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"fromNumber",children:"From Number"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(h,{id:"fromNumber",placeholder:"+1234567890",className:"pl-10",value:t.fromNumber,onChange:s=>r("fromNumber",s.target.value)})]})]})]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"API Configuration"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"apiKey",children:"API Key"}),e.jsx(h,{id:"apiKey",type:"password",placeholder:"Enter your API key",value:t.apiKey,onChange:s=>r("apiKey",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"apiSecret",children:"API Secret"}),e.jsx(h,{id:"apiSecret",type:"password",placeholder:"Enter your API secret",value:t.apiSecret,onChange:s=>r("apiSecret",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"webhookUrl",children:"Webhook URL (Optional)"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(h,{id:"webhookUrl",placeholder:"https://your-webhook-url.com/sms",className:"pl-10",value:t.webhookUrl,onChange:s=>r("webhookUrl",s.target.value)})]})]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Test Configuration"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"testPhone",children:"Test Phone Number"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(h,{id:"testPhone",placeholder:"+1234567890",className:"pl-10",value:t.testPhoneNumber,onChange:s=>r("testPhoneNumber",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"testMessage",children:"Test Message"}),e.jsx(x,{id:"testMessage",placeholder:"Enter a test message to send...",value:w,onChange:s=>P(s.target.value),rows:3})]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"SMS Templates"]})}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-base font-semibold",children:"Voucher Generated"}),e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Sent when a voucher is created"}),e.jsx(x,{value:t.templates.voucherGenerated,onChange:s=>p("voucherGenerated",s.target.value),rows:2,placeholder:"Your voucher message..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Available variables: ",{VOUCHER_CODE},", ",{AMOUNT},", ",{EXPIRY_DATE}]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-base font-semibold",children:"Payment Confirmation"}),e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Sent when payment is confirmed"}),e.jsx(x,{value:t.templates.paymentConfirmation,onChange:s=>p("paymentConfirmation",s.target.value),rows:2,placeholder:"Your payment confirmation message..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Available variables: ",{AMOUNT},", ",{VOUCHER_CODE}]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-base font-semibold",children:"Password Reset"}),e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Sent for password reset codes"}),e.jsx(x,{value:t.templates.passwordReset,onChange:s=>p("passwordReset",s.target.value),rows:2,placeholder:"Your password reset message..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Available variables: ",{RESET_CODE}]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-base font-semibold",children:"System Alert"}),e.jsx("p",{className:"text-sm text-slate-500 mb-2",children:"Sent for system notifications"}),e.jsx(x,{value:t.templates.systemAlert,onChange:s=>p("systemAlert",s.target.value),rows:2,placeholder:"Your system alert message..."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Available variables: ",{MESSAGE}]})]})]})]}),e.jsxs(o,{children:[e.jsx(c,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Usage Statistics"]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:"0"}),e.jsx("div",{className:"text-sm text-slate-500",children:"SMS Sent Today"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"0"}),e.jsx("div",{className:"text-sm text-slate-500",children:"This Week"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"0"}),e.jsx("div",{className:"text-sm text-slate-500",children:"This Month"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"0"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Sent"})]})]})})]})]})};export{B as default};

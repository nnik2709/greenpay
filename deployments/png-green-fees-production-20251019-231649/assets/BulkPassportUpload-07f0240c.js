import{p as G,h as K,u as T,r,j as e,m as S,L as d,I as x,x as B,B as m,a9 as A,v as Q,A as Y,D as J,i as W,k as X,l as Z,n as ee,o as se,E as q,s as E,F as te,S as ae,w as le}from"./index-f386841f.js";import{S as U}from"./switch-357df985.js";import{R as re,a as ie}from"./radio-group-188719c7.js";import{C as ne}from"./calendar-a622c72a.js";import{S as de}from"./shield-c3edc8ad.js";import{A as oe}from"./arrow-left-f0f484f3.js";import{g as ce,u as me}from"./bulkUploadService-98bf8c81.js";import{H as ue}from"./history-bbb4473d.js";import{Q as xe}from"./qr-code-f7e195e1.js";import{F as he}from"./file-spreadsheet-279cbcb4.js";const pe=G("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),be=()=>{const i=K(),{toast:u}=T(),[h,N]=r.useState("BANK TRANSFER"),[p,v]=r.useState(0),[b,F]=r.useState(50),c=50,n=c-c*(p/100),y=b-n,f=a=>{a.preventDefault(),console.log("Payment Data:",{totalAmount:c,discount:p,amountAfterDiscount:n,collectedAmount:b,returnedAmount:y,paymentMode:h}),u({title:"Payment Processed!",description:"The payment has been successfully recorded.",variant:"success"}),i("/")},w=()=>{i(-1)};return e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-emerald-100",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Process Payment"}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"total_amount",children:"Total Amount"}),e.jsx(x,{id:"total_amount",value:c.toFixed(2),readOnly:!0,className:"bg-slate-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"discount",children:"Discount (%)"}),e.jsx(x,{id:"discount",type:"number",value:p,onChange:a=>v(parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"amount_after_discount",children:"Amount After Discount"}),e.jsx(x,{id:"amount_after_discount",value:n.toFixed(2),readOnly:!0,className:"bg-slate-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"collected_amount",children:"Collected Amount"}),e.jsx(x,{id:"collected_amount",type:"number",value:b,onChange:a=>F(parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"returned_amount",children:"Returned Amount"}),e.jsx(x,{id:"returned_amount",value:y>0?y.toFixed(2):"0.00",readOnly:!0,className:"bg-slate-100"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{children:"Payment Mode"}),e.jsx(re,{defaultValue:"BANK TRANSFER",onValueChange:N,className:"flex flex-wrap gap-4",children:["BANK TRANSFER","CASH","CHEQUE","CREDIT CARD","DEBIT CARD"].map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{value:a,id:a}),e.jsx(d,{htmlFor:a,className:"font-normal",children:a})]},a))})]}),["CREDIT CARD","DEBIT CARD"].includes(h)&&e.jsxs("div",{className:"space-y-4 border-t border-slate-200 pt-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"card-number",children:"Card Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(x,{id:"card-number",placeholder:"0000 0000 0000 0000",className:"pl-10 h-11 border-emerald-200"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"expiry",children:"Expiry Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(x,{id:"expiry",placeholder:"MM / YY",className:"pl-10 h-11 border-emerald-200"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cvc",children:"CVC"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(x,{id:"cvc",placeholder:"123",className:"pl-10 h-11 border-emerald-200"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-slate-200",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:w,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs(m,{type:"submit",size:"lg",className:"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg hover:shadow-xl transition-all",children:["Process Payment ",e.jsx(A,{className:"w-5 h-5 ml-2"})]})]})]})]})})},P=[{id:1,name:"Upload File",icon:q},{id:2,name:"Payment",icon:B},{id:3,name:"View Vouchers",icon:xe}],fe=[{id:"passportNo",label:"Passport Number",required:!0,enabled:!0},{id:"surname",label:"Surname",required:!0,enabled:!0},{id:"givenName",label:"Given Name",required:!0,enabled:!0},{id:"nationality",label:"Nationality",required:!0,enabled:!0},{id:"dob",label:"Date of Birth",required:!0,enabled:!0},{id:"sex",label:"Sex",required:!0,enabled:!0},{id:"dateOfExpiry",label:"Passport Expiry Date",required:!0,enabled:!0},{id:"placeOfBirth",label:"Place of Birth",required:!1,enabled:!1},{id:"placeOfIssue",label:"Place of Issue",required:!1,enabled:!1},{id:"dateOfIssue",label:"Date of Issue",required:!1,enabled:!1},{id:"fileNumber",label:"File Number",required:!1,enabled:!1},{id:"email",label:"Email Address",required:!1,enabled:!1},{id:"phone",label:"Phone Number",required:!1,enabled:!1}],Pe=()=>{const{toast:i}=T();Q();const[u,h]=r.useState(1),[N,p]=r.useState(null),[v,b]=r.useState(0),[F,c]=r.useState(!1),[n,y]=r.useState(fe),[f,w]=r.useState(!1),[a,k]=r.useState([]),[D,R]=r.useState(null);r.useEffect(()=>{C()},[]),r.useEffect(()=>{(async()=>{const{data:{session:t}}=await E.auth.getSession();console.log("Auth check on mount:",t?"Authenticated":"Not authenticated"),!t||!t.user?i({title:"Authentication Required",description:"Please log in to use bulk upload",variant:"destructive"}):console.log("User is logged in:",t.user.email)})()},[]);const C=async()=>{try{const s=await ce(5);k(s.map(t=>({id:t.id||"N/A",date:new Date(t.created_at).toLocaleDateString(),passports:t.total_records||0,status:t.status||"Unknown"})))}catch(s){console.error("Error fetching recent uploads:",s)}},I=async s=>{const t=s.target.files[0];if(!t)return;const{data:{session:o}}=await E.auth.getSession();if(!o||!o.user){i({title:"Not Authenticated",description:"Please log in to upload files",variant:"destructive"}),s.target.value="";return}p(t),w(!0),console.log("Starting file upload:",t.name);try{const l=await me(t);if(console.log("Upload result:",l),R(l),b(l.successCount),l.success)l.errors.length>0?i({title:"Partial Success",description:`${l.successCount} passports uploaded, ${l.errorCount} had errors`,variant:"warning"}):i({title:"Upload Successful",description:`${l.successCount} passports processed successfully`}),C();else throw new Error(l.message||"Upload failed")}catch(l){console.error("Upload error:",l),i({title:"Upload Failed",description:l.message||"Failed to process file",variant:"destructive"}),p(null),b(0)}finally{w(!1)}},O=()=>{if(!N){i({title:"No File Uploaded",description:"Please upload an Excel file to proceed.",variant:"destructive"});return}h(2)},_=s=>{h(3),C(),i({title:"Payment Successful!",description:"Vouchers for your bulk upload have been generated."})},V=()=>{h(1),p(null),b(0),R(null),C()},L=s=>{y(t=>t.map(o=>o.id===s&&!o.required?{...o,enabled:!o.enabled}:o))},$=()=>{const s=n.filter(g=>g.enabled),t=s.map(g=>g.id),o={passportNo:"P123456789",surname:"Doe",givenName:"John",nationality:"Papua New Guinea",dob:"1990-01-01",sex:"Male",dateOfExpiry:"2030-01-01",placeOfBirth:"Port Moresby",placeOfIssue:"Port Moresby",dateOfIssue:"2020-01-01",fileNumber:"FILE001",email:"john.doe@example.com",phone:"+675 1234 5678"},l=s.map(g=>o[g.id]||""),H=[t.join(","),l.join(",")].join(`
`),z=new Blob([H],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a");if(j.download!==void 0){const g=URL.createObjectURL(z);j.setAttribute("href",g),j.setAttribute("download","passport_template.csv"),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j)}i({title:"Template Downloaded",description:`CSV template with ${s.length} fields has been downloaded.`})},M=()=>{switch(u){case 1:return e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsxs("div",{className:"text-center p-10 border-2 border-dashed border-emerald-300 rounded-xl bg-emerald-50/50",children:[e.jsx(q,{className:"mx-auto h-12 w-12 text-emerald-500"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-slate-800",children:"Drag & drop your file here"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"or"}),e.jsxs("label",{htmlFor:"file-upload",className:`relative rounded-md font-semibold text-emerald-600 hover:text-emerald-500 ${f?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:[e.jsx("span",{children:f?"Processing...":"Browse files"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:I,accept:".xlsx, .xls, .csv",disabled:f})]}),N&&e.jsxs("div",{className:"mt-4 text-sm text-slate-700 flex flex-col items-center justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("span",{children:[N.name," (",v," passports processed)"]})]}),D&&D.errorCount>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:[D.errorCount," records had errors"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Configure Template"]}),e.jsxs(m,{variant:"outline",onClick:$,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Download Template (",n.filter(s=>s.enabled).length," fields)"]})]}),e.jsxs(m,{onClick:O,size:"lg",className:"bg-gradient-to-r from-emerald-500 to-teal-600 text-white",disabled:f,children:[f?"Processing...":"Proceed to Payment"," ",e.jsx(pe,{className:"w-5 h-5 ml-2"})]})]})]});case 2:return e.jsx(be,{onBack:()=>h(1),onPay:_});case 3:return e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center space-y-6 p-8 bg-white/80 rounded-xl",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(A,{className:"w-12 h-12 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Upload & Payment Successful!"}),e.jsxs("p",{className:"text-slate-600",children:["Successfully processed ",e.jsx("span",{className:"font-bold text-emerald-700",children:v})," passports from your file ",e.jsx("span",{className:"font-semibold",children:N.name}),"."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs(m,{size:"lg",className:"bg-slate-700 hover:bg-slate-800 text-white",children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Download Vouchers (CSV)"]}),e.jsx(m,{size:"lg",variant:"outline",onClick:V,children:"Start New Bulk Upload"})]})]});default:return null}};return e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent mb-3",children:"Bulk Passport Upload"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("nav",{"aria-label":"Progress",className:"mb-8",children:e.jsx("ol",{role:"list",className:"flex items-center",children:P.map((s,t)=>e.jsxs("li",{className:`flex-1 ${t!==P.length-1?"pr-8 sm:pr-20":""} relative`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`flex h-10 w-10 items-center justify-center rounded-full ${u>s.id?"bg-emerald-600":u===s.id?"bg-emerald-500":"bg-slate-300"}`,children:u>s.id?e.jsx(A,{className:"h-6 w-6 text-white"}):e.jsx(s.icon,{className:"h-6 w-6 text-white"})}),e.jsx("span",{className:`ml-4 text-sm font-medium ${u>=s.id?"text-emerald-700":"text-slate-500"}`,children:s.name})]}),t!==P.length-1?e.jsx("div",{className:"absolute top-1/2 left-4 -translate-y-1/2 h-0.5 bg-slate-300 w-full",style:{left:"2.5rem",right:"-2.5rem"}}):null]},s.name))})}),e.jsx("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-emerald-100",children:e.jsx(Y,{mode:"wait",children:e.jsx("div",{children:M()},u)})})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white/60 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100 h-full",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center mb-4",children:[e.jsx(ue,{className:"w-5 h-5 mr-2 text-emerald-600"}),"Recent Uploads"]}),a.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-8",children:"No recent uploads"}):e.jsx("ul",{className:"space-y-3",children:a.map(s=>e.jsxs("li",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"font-semibold text-slate-700 text-xs truncate",children:["ID: ",s.id]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s.status==="completed"||s.status==="Completed"?"bg-green-100 text-green-800":s.status==="failed"||s.status==="Failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status})]}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[s.date," - ",s.passports," passports"]})]},s.id))})]})})]}),e.jsx(J,{open:F,onOpenChange:c,children:e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Configure CSV Template Fields"}),e.jsx(ee,{children:"Enable or disable fields to include in your CSV template. Required fields cannot be disabled."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs rounded",children:"Required"}),"Essential Fields"]}),e.jsx("div",{className:"space-y-3 pl-4 border-l-2 border-red-200",children:n.filter(s=>s.required).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:s.id,className:"font-medium text-slate-700",children:s.label}),e.jsxs("p",{className:"text-xs text-slate-500 mt-0.5",children:["Field ID: ",s.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Always included"}),e.jsx(U,{id:s.id,checked:!0,disabled:!0})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 text-xs rounded",children:"Optional"}),"Additional Fields"]}),e.jsx("div",{className:"space-y-3 pl-4 border-l-2 border-emerald-200",children:n.filter(s=>!s.required).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:s.id,className:"font-medium text-slate-700 cursor-pointer",children:s.label}),e.jsxs("p",{className:"text-xs text-slate-500 mt-0.5",children:["Field ID: ",s.id]})]}),e.jsx(U,{id:s.id,checked:s.enabled,onCheckedChange:()=>L(s.id)})]},s.id))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Total fields enabled:"})," ",n.filter(s=>s.enabled).length," out of ",n.length]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Your CSV template will include these ",n.filter(s=>s.enabled).length," fields when downloaded."]})]})]}),e.jsxs(se,{children:[e.jsx(m,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(m,{onClick:()=>{c(!1),i({title:"Configuration Saved",description:`Template configured with ${n.filter(s=>s.enabled).length} fields.`})},children:"Save Configuration"})]})]})})]})};export{Pe as default};

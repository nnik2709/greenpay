import{s as Z,G as Oe,H as X,r as i,j as e,T as Me,O as Fe,J as ee,W as Ue,K as ke,M as Ie,N as $e,Q as Le,R as se,V as He,Y as ze,Z as Ve,t as N,_ as h,$ as ae,u as qe,h as Ge,B as c,I as b,D as L,i as H,k as z,l as V,n as q,L as v,o as G,a0 as B,a1 as Be}from"./index-f386841f.js";import{S as K,a as W,b as Y,c as J,d as x}from"./select-14269127.js";import{H as Ke}from"./history-bbb4473d.js";import{U as We}from"./user-plus-0adf7eae.js";import{S as Ye}from"./search-0da320f8.js";import{K as Je}from"./key-95ea7c62.js";const Qe=async()=>{try{const{data:a,error:t}=await Z.rpc("get_all_users");if(t)throw t;return a||[]}catch(a){return console.error("Error loading users:",a),[]}};var te="AlertDialog",[Ze,js]=Oe(te,[X]),m=X(),re=a=>{const{__scopeAlertDialog:t,...r}=a,l=m(t);return e.jsx(He,{...l,...r,modal:!0})};re.displayName=te;var Xe="AlertDialogTrigger",es=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,n=m(r);return e.jsx(Me,{...n,...l,ref:t})});es.displayName=Xe;var ss="AlertDialogPortal",le=a=>{const{__scopeAlertDialog:t,...r}=a,l=m(t);return e.jsx(ze,{...l,...r})};le.displayName=ss;var as="AlertDialogOverlay",ie=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,n=m(r);return e.jsx(Fe,{...n,...l,ref:t})});ie.displayName=as;var f="AlertDialogContent",[ts,rs]=Ze(f),ls=Ve("AlertDialogContent"),oe=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,children:l,...n}=a,u=m(r),j=i.useRef(null),y=ee(t,j),D=i.useRef(null);return e.jsx(Ue,{contentName:f,titleName:ne,docsSlug:"alert-dialog",children:e.jsx(ts,{scope:r,cancelRef:D,children:e.jsxs(ke,{role:"alertdialog",...u,...n,ref:y,onOpenAutoFocus:Ie(n.onOpenAutoFocus,p=>{var C;p.preventDefault(),(C=D.current)==null||C.focus({preventScroll:!0})}),onPointerDownOutside:p=>p.preventDefault(),onInteractOutside:p=>p.preventDefault(),children:[e.jsx(ls,{children:l}),e.jsx(os,{contentRef:j})]})})})});oe.displayName=f;var ne="AlertDialogTitle",ce=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,n=m(r);return e.jsx($e,{...n,...l,ref:t})});ce.displayName=ne;var de="AlertDialogDescription",pe=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,n=m(r);return e.jsx(Le,{...n,...l,ref:t})});pe.displayName=de;var is="AlertDialogAction",me=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,n=m(r);return e.jsx(se,{...n,...l,ref:t})});me.displayName=is;var xe="AlertDialogCancel",he=i.forwardRef((a,t)=>{const{__scopeAlertDialog:r,...l}=a,{cancelRef:n}=rs(xe,r),u=m(r),j=ee(t,n);return e.jsx(se,{...u,...l,ref:j})});he.displayName=xe;var os=({contentRef:a})=>{const t=`\`${f}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${f}\` by passing a \`${de}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${f}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{var l;document.getElementById((l=a.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(t)},[t,a]),null},ns=re,cs=le,ge=ie,ue=oe,je=me,ve=he,fe=ce,Ne=pe;const Q=ns,ds=cs,ye=N.forwardRef(({className:a,...t},r)=>e.jsx(ge,{className:h("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t,ref:r}));ye.displayName=ge.displayName;const P=N.forwardRef(({className:a,...t},r)=>e.jsxs(ds,{children:[e.jsx(ye,{}),e.jsx(ue,{ref:r,className:h("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...t})]}));P.displayName=ue.displayName;const T=({className:a,...t})=>e.jsx("div",{className:h("flex flex-col space-y-2 text-center sm:text-left",a),...t});T.displayName="AlertDialogHeader";const O=({className:a,...t})=>e.jsx("div",{className:h("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});O.displayName="AlertDialogFooter";const M=N.forwardRef(({className:a,...t},r)=>e.jsx(fe,{ref:r,className:h("text-lg font-semibold",a),...t}));M.displayName=fe.displayName;const F=N.forwardRef(({className:a,...t},r)=>e.jsx(Ne,{ref:r,className:h("text-sm text-muted-foreground",a),...t}));F.displayName=Ne.displayName;const U=N.forwardRef(({className:a,...t},r)=>e.jsx(je,{ref:r,className:h(ae(),a),...t}));U.displayName=je.displayName;const k=N.forwardRef(({className:a,...t},r)=>e.jsx(ve,{ref:r,className:h(ae({variant:"outline"}),"mt-2 sm:mt-0",a),...t}));k.displayName=ve.displayName;function vs(){const{toast:a}=qe(),t=Ge(),[r,l]=i.useState([]),[n,u]=i.useState(!0),[j,y]=i.useState(!1),[D,p]=i.useState(!1),[C,E]=i.useState(!1),[we,R]=i.useState(!1),[o,_]=i.useState(null),[d,w]=i.useState(null),[g,S]=i.useState({email:"",password:"",role:""}),[I,$]=i.useState(!1);i.useEffect(()=>{Ae()},[]);const Ae=async()=>{u(!0);try{const s=await Qe();l(s)}catch(s){console.error("Error loading users:",s),a({variant:"destructive",title:"Error",description:"Failed to load users"})}finally{u(!1)}};i.useEffect(()=>{w(o?{...o,password:""}:null)},[o]);const be=s=>{t("/admin/login-history",{state:{userFilter:s.id,userName:s.email}})},De=s=>{s.preventDefault();const A=r.length>0?Math.max(...r.map(Te=>Te.id))+1:1;l([...r,{...g,id:A,active:!0}]),y(!1),S({email:"",password:"",role:""}),a({title:"User Added! ðŸŽ‰",description:`User ${g.email} has been successfully created.`})},Ce=s=>{_(s),p(!0)},Se=s=>{s.preventDefault(),l(r.map(A=>A.id===d.id?{...A,email:d.email,role:d.role}:A)),p(!1),a({title:"User Updated! âœ¨",description:`User ${d.email}'s details have been updated.`})},Ee=s=>{_(s),E(!0)},Re=()=>{l(r.map(s=>s.id===o.id?{...s,active:!s.active}:s)),E(!1),a({title:`User ${o.active?"Deactivated":"Activated"}!`,description:`User ${o.email}'s status has been updated.`})},_e=s=>{_(s),R(!0)},Pe=async()=>{if(o){$(!0);try{const{error:s}=await Z.auth.resetPasswordForEmail(o.email,{redirectTo:`${window.location.origin}/reset-password`});if(s)throw s;a({title:"Password Reset Email Sent! ðŸ“§",description:`A password reset link has been sent to ${o.email}`}),R(!1)}catch(s){console.error("Password reset error:",s),a({title:"Error",description:s.message||"Failed to send password reset email",variant:"destructive"})}finally{$(!1)}}};return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Users"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>t("/admin/login-history"),variant:"outline",className:"text-emerald-600 border-emerald-300 hover:bg-emerald-50",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Login History"]}),e.jsxs(c,{onClick:()=>y(!0),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Add User"]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing 1 to ",r.length," of ",r.length," entries"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(b,{placeholder:"Search...",className:"pl-9"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-600",children:[e.jsx("thead",{className:"text-xs text-slate-700 uppercase bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Login History"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-8 text-center text-slate-500",children:'No users found. Click "Add User" to create the first user.'})}):r.map(s=>e.jsxs("tr",{className:"bg-white border-b hover:bg-slate-50",children:[e.jsx("td",{className:"px-6 py-4",children:s.id}),e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:s.role.replace(/_/g," ")}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s.active?"text-green-800 bg-green-100":"text-red-800 bg-red-100"}`,children:s.active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(c,{variant:"link",className:"p-0 h-auto text-emerald-600 hover:text-emerald-700",onClick:()=>be(s),children:"View Login History"})}),e.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Ce(s),children:"Edit"}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>_e(s),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"Reset Password"]}),e.jsx(c,{size:"sm",variant:s.active?"destructive":"outline",onClick:()=>Ee(s),children:s.active?"Deactivate":"Activate"})]})]},s.id))})]})}),e.jsx("div",{className:"flex items-center justify-end pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",disabled:!0,children:"Previous"}),e.jsx(c,{variant:"outline",size:"sm",className:"bg-emerald-100",children:"1"}),e.jsx(c,{variant:"outline",size:"sm",disabled:!0,children:"Next"})]})})]})]}),e.jsx(L,{open:j,onOpenChange:y,children:e.jsxs(H,{children:[e.jsxs(z,{children:[e.jsx(V,{children:"Add New User"}),e.jsx(q,{children:"Create a new user account and assign a role."})]}),e.jsxs("form",{onSubmit:De,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(b,{id:"email",type:"email",value:g.email,onChange:s=>S({...g,email:s.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"password",className:"text-right",children:"Password"}),e.jsx(b,{id:"password",type:"password",value:g.password,onChange:s=>S({...g,password:s.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"role",className:"text-right",children:"Role"}),e.jsxs(K,{onValueChange:s=>S({...g,role:s}),required:!0,children:[e.jsx(W,{className:"col-span-3",children:e.jsx(Y,{placeholder:"Select a role"})}),e.jsxs(J,{children:[e.jsx(x,{value:"Flex_Admin",children:"Flex Admin"}),e.jsx(x,{value:"Finance_Manager",children:"Finance Manager"}),e.jsx(x,{value:"Counter_Agent",children:"Counter Agent"}),e.jsx(x,{value:"IT_Support",children:"IT Support"})]})]})]})]}),e.jsxs(G,{children:[e.jsx(B,{asChild:!0,children:e.jsx(c,{type:"button",variant:"secondary",children:"Cancel"})}),e.jsx(c,{type:"submit",children:"Add User"})]})]})]})}),e.jsx(L,{open:D,onOpenChange:p,children:e.jsxs(H,{children:[e.jsxs(z,{children:[e.jsx(V,{children:"Edit User"}),e.jsx(q,{children:"Update the user's details. Leave password blank to keep it unchanged."})]}),d&&e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"edit-email",className:"text-right",children:"Email"}),e.jsx(b,{id:"edit-email",type:"email",value:d.email,onChange:s=>w({...d,email:s.target.value}),className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"edit-password",className:"text-right",children:"Password"}),e.jsx(b,{id:"edit-password",type:"password",placeholder:"Leave blank to keep current",value:d.password,onChange:s=>w({...d,password:s.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(v,{htmlFor:"edit-role",className:"text-right",children:"Role"}),e.jsxs(K,{value:d.role,onValueChange:s=>w({...d,role:s}),required:!0,children:[e.jsx(W,{className:"col-span-3",children:e.jsx(Y,{placeholder:"Select a role"})}),e.jsxs(J,{children:[e.jsx(x,{value:"Flex_Admin",children:"Flex Admin"}),e.jsx(x,{value:"Finance_Manager",children:"Finance Manager"}),e.jsx(x,{value:"Counter_Agent",children:"Counter Agent"}),e.jsx(x,{value:"IT_Support",children:"IT Support"})]})]})]})]}),e.jsxs(G,{children:[e.jsx(B,{asChild:!0,children:e.jsx(c,{type:"button",variant:"secondary",children:"Cancel"})}),e.jsx(c,{type:"submit",children:"Save Changes"})]})]})]})}),e.jsx(Q,{open:C,onOpenChange:E,children:e.jsxs(P,{children:[e.jsxs(T,{children:[e.jsx(M,{children:"Are you sure?"}),e.jsxs(F,{children:["This will ",o!=null&&o.active?"deactivate":"activate"," the user account for ",e.jsx("span",{className:"font-bold",children:o==null?void 0:o.email}),". They will ",o!=null&&o.active?"lose":"regain"," access to the system."]})]}),e.jsxs(O,{children:[e.jsx(k,{children:"Cancel"}),e.jsx(U,{onClick:Re,children:"Confirm"})]})]})}),e.jsx(Q,{open:we,onOpenChange:R,children:e.jsxs(P,{children:[e.jsxs(T,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-600"}),"Send Password Reset Email"]}),e.jsxs(F,{children:["This will send a password reset email to ",e.jsx("span",{className:"font-bold",children:o==null?void 0:o.email}),". The user will receive a secure link to reset their password, which will expire in 24 hours."]})]}),e.jsxs(O,{children:[e.jsx(k,{children:"Cancel"}),e.jsx(U,{onClick:Pe,disabled:I,className:"bg-blue-600 hover:bg-blue-700",children:I?"Sending...":"Send Reset Email"})]})]})})]})}export{vs as default};

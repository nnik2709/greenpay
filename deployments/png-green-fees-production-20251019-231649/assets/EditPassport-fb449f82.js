import{p as P,s as f,q,h as I,u as k,r as p,j as e,m as D,B as j,g as M,L as l,I as n}from"./index-f386841f.js";import{S as A,a as B,b as U,c as V,d as v}from"./select-14269127.js";import{A as L}from"./arrow-left-f0f484f3.js";import{H as T}from"./hash-110faeb3.js";import{G as b}from"./globe-21edfe06.js";import{U as y}from"./user-806b4eaa.js";import{C as g}from"./calendar-a622c72a.js";import{S as z}from"./save-bfaf2e9f.js";const G=P("VenetianMask",[["path",{d:"M2 12a5 5 0 0 0 5 5 8 8 0 0 1 5 2 8 8 0 0 1 5-2 5 5 0 0 0 5-5V7h-5a8 8 0 0 0-5 2 8 8 0 0 0-5-2H2Z",key:"1g6z3j"}],["path",{d:"M6 11c1.5 0 3 .5 3 2-2 0-3 0-3-2Z",key:"c2lwnf"}],["path",{d:"M18 11c-1.5 0-3 .5-3 2 2 0 3 0 3-2Z",key:"njd9zo"}]]);async function H(d){try{const{data:r,error:a}=await f.from("passports").select("*").eq("id",d).single();if(a)throw a;return r}catch(r){throw console.error("Error fetching passport:",r),r}}async function O(d,r){try{const{data:{user:a}}=await f.auth.getUser();if(!a)return{success:!1,error:"User not authenticated"};const u={...r,updated_at:new Date().toISOString(),updated_by:a.id},{data:h,error:c}=await f.from("passports").update(u).eq("id",d).select().single();if(c)return{success:!1,error:c.message};try{await f.from("audit_logs").insert([{table_name:"passports",record_id:d,action:"UPDATE",old_values:null,new_values:u,user_id:a.id}])}catch(x){console.warn("Failed to create audit log:",x)}return{success:!0,data:h}}catch(a){return console.error("Error updating passport:",a),{success:!1,error:a.message}}}const $=()=>{const{id:d}=q(),r=I(),{toast:a}=k(),[u,h]=p.useState(!0),[c,x]=p.useState(!1),[m,N]=p.useState(null),[t,_]=p.useState({passport_number:"",nationality:"",surname:"",given_name:"",date_of_birth:"",sex:"",date_of_expiry:"",place_of_birth:"",place_of_issue:"",date_of_issue:""});p.useEffect(()=>{w()},[d]);const w=async()=>{try{h(!0);const s=await H(d);if(!s){a({variant:"destructive",title:"Passport Not Found",description:"The requested passport could not be found."}),r("/passports");return}N(s),_({passport_number:s.passport_number||"",nationality:s.nationality||"",surname:s.surname||"",given_name:s.given_name||"",date_of_birth:s.date_of_birth||"",sex:s.sex||"",date_of_expiry:s.date_of_expiry||"",place_of_birth:s.place_of_birth||"",place_of_issue:s.place_of_issue||"",date_of_issue:s.date_of_issue||""})}catch(s){console.error("Error loading passport:",s),a({variant:"destructive",title:"Error",description:"Failed to load passport data."})}finally{h(!1)}},i=s=>{const{name:o,value:F}=s.target;_(E=>({...E,[o]:F}))},S=s=>{_(o=>({...o,sex:s}))},C=async s=>{s.preventDefault();try{if(x(!0),!t.passport_number||!t.surname||!t.given_name){a({variant:"destructive",title:"Validation Error",description:"Please fill in all required fields."});return}const o=await O(d,t);if(o.success)a({title:"Success",description:"Passport updated successfully!"}),r("/passports");else throw new Error(o.error||"Failed to update passport")}catch(o){console.error("Error updating passport:",o),a({variant:"destructive",title:"Error",description:o.message||"Failed to update passport."})}finally{x(!1)}};return u?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600"})}):e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Edit Passport"}),e.jsxs("p",{className:"text-slate-500 mt-2",children:["Update passport information for ",m==null?void 0:m.surname," ",m==null?void 0:m.given_name]})]}),e.jsxs(j,{variant:"outline",onClick:()=>r("/passports"),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Back to Passports"]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold",children:"Important:"}),e.jsx("p",{children:"Changes to passport information will be logged for audit purposes. Ensure all information is accurate before saving."})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-emerald-100",children:e.jsxs("form",{onSubmit:C,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800 border-b pb-2",children:"Core Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"passport_number",children:"Passport Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"passport_number",id:"passport_number",value:t.passport_number,onChange:i,placeholder:"e.g., P1234567",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"nationality",children:"Nationality *"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"nationality",id:"nationality",value:t.nationality,onChange:i,placeholder:"e.g., Australian",className:"pl-10",required:!0})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800 border-b pb-2",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"surname",children:"Surname *"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"surname",id:"surname",value:t.surname,onChange:i,placeholder:"e.g., Smith",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"given_name",children:"Given Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"given_name",id:"given_name",value:t.given_name,onChange:i,placeholder:"e.g., John",className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"date_of_birth",children:"Date of Birth *"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"date_of_birth",id:"date_of_birth",type:"date",value:t.date_of_birth,onChange:i,className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"sex",children:"Sex *"}),e.jsxs(A,{value:t.sex,onValueChange:S,required:!0,children:[e.jsxs(B,{id:"sex",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(U,{placeholder:"Select sex",className:"pl-10"})]}),e.jsxs(V,{children:[e.jsx(v,{value:"Male",children:"Male"}),e.jsx(v,{value:"Female",children:"Female"}),e.jsx(v,{value:"Other",children:"Other"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800 border-b pb-2",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"date_of_expiry",children:"Expiry Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"date_of_expiry",id:"date_of_expiry",type:"date",value:t.date_of_expiry,onChange:i,className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"date_of_issue",children:"Issue Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"date_of_issue",id:"date_of_issue",type:"date",value:t.date_of_issue,onChange:i,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"place_of_birth",children:"Place of Birth"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"place_of_birth",id:"place_of_birth",value:t.place_of_birth,onChange:i,placeholder:"e.g., Sydney",className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"place_of_issue",children:"Place of Issue"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"}),e.jsx(n,{name:"place_of_issue",id:"place_of_issue",value:t.place_of_issue,onChange:i,placeholder:"e.g., Sydney",className:"pl-10"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-200",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>r("/passports"),disabled:c,children:"Cancel"}),e.jsx(j,{type:"submit",size:"lg",disabled:c,className:"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg hover:shadow-xl transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Save Changes"]})})]})]})})]})};export{$ as default};
